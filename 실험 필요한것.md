# 프로젝트: 고막 천공 시뮬레이터 (Unity 기반)

## 1. 프로젝트 목적
고막에 천공(구멍)이 생겼을 때, 외이도에서 발생한 음파가 이소골 끝(등골 족판)까지 전달되는 과정에서 얼마나 감쇄되는지 시뮬레이션하는 Unity 프로젝트.

### 핵심 질문
- 고막 구멍의 크기에 따라 청력 손실이 얼마나 달라지는가?
- 고막 구멍의 위치에 따라 청력 손실이 얼마나 달라지는가?
- 주파수별로 감쇄 특성이 어떻게 다른가?

### 용도
- 과학 논문용 시뮬레이션
- 정밀한 물리 시뮬레이션은 아니어도 되지만, 논문에서 정당화 가능한 수준의 근사 모델 필요

---

## 2. 현재 가지고 있는 것

### 3D 모델 (Unity에 import 완료)
- 고막 mesh 모델
- 이소골 mesh 모델 (추골, 침골, 등골)

### 실제 환자 데이터 (Excel)
- 고막 천공 크기별 청력 손실 데이터
- 주파수별 dB 값
- 수술 전/후 비교 데이터

---

## 3. 시뮬레이션 구조

### 음파 경로
[외이도 입구] → 음파 → [고막] → 진동 전달 → [추골-침골-등골] → [등골 족판]
     ↑                    ↑                                            ↑
   Source            구멍 위치/크기 변수                              Observer

### 위치 정의
- Source: 외이도 입구 (음파 발생 지점)
- Observer: 등골(Stapes)의 족판(Footplate) 끝부분 (난원창에 붙는 부분)

### 변수
- 고막의 구멍 위치
- 고막의 구멍 크기 (0~4단계)
- 음파 주파수 (0.125kHz ~ 8kHz)

---

## 4. 구현해야 할 것

### 4.1 고막 mesh에 구멍 뚫는 시스템
- 런타임 mesh 변형 또는 프리셋 방식
- 4분면 × 4~5가지 크기 = 16~20개 프리셋 추천

### 4.2 음파 전파 근사 모델
Unity 물리엔진은 음파 전파를 지원하지 않으므로 직접 구현 필요.

제안 모델:
총 진동 세기: I_total = I_direct + I_solid

- I_direct = I₀ × T_hole × (1/r²) : 구멍 통과 경로 (누출)
- I_solid = I₀ × T_material × e^(-αd) : 고막을 통한 진동 전달 경로

변수 설명:
- I₀: 소스 진동 세기
- T_hole: 구멍 투과율 (구멍 면적 / 전체 고막 면적)
- T_material: 재질 투과 계수 (0~1)
- α: 감쇠 계수 (주파수별로 다름)
- d: 전파 거리
- r: source-observer 거리

### 4.3 주파수별 감쇄 특성
- 저주파: 구멍 영향 적음
- 고주파: 구멍 영향 큼

### 4.4 Observer 지점에서 최종 진동 세기 계산

### 4.5 시각화 (선택)
- 진동 세기: Color gradient 또는 particle density
- 전파 경로: LineRenderer로 표시

---

## 5. 검증 방법
시뮬레이션 결과 vs 실제 환자 데이터 비교
- 상관계수 분석
- 주파수별 오차 분석
- 천공 크기별 정확도

---

## 6. 환자 데이터 상세 설명

### 파일 정보
- 파일명: 시뮬레이터_데이터_명단_251114.xlsx
- 시트 2개:
  - 고대공대_CWD (Canal Wall Down 수술 환자 63명)
  - 고대공대_ICW (Intact Canal Wall 수술 환자 30명)

### 환자 기본 정보
- 나이, 나이대, sex (1: 남자, 2: 여자)
- 진단명: Chole(진주종), COM(만성중이염), Fistula 등
- 수술명: PORP, TORP, T1, T3, T4 등 (이소골 재건 방식)

### 날짜/기간 정보
- CT 촬영일자, MRI 촬영일자
- 수술날짜
- Duration_PTA-Surgery: PTA 검사일과 수술일 간격 (일)
- Duration_Surgery-PTA: 수술일과 수술후 PTA 검사일 간격 (일)

### 청력 검사 데이터 (PTA - Pure Tone Audiometry)

측정 시점:
- 수술전
- 수술후 3M (3개월)
- 수술후 6M (6개월)
- 수술후 1Y (1년)

주파수별 청력 역치 (dB):
- 0.125, 0.25, 0.5, 1, 2, 3, 4, 8 kHz

귀 구분:
- R_B, L_B: 우측/좌측 골도(Bone conduction)
- R_A, L_A: 우측/좌측 기도(Air conduction)

Quarter 값:
- R_B Quarter, L_B Quarter: 골도 4분법 평균
- R_A Quarter, L_A Quarter: 기도 4분법 평균

### 청력 손실 지표
- R_Average, L_Average: 500Hz, 1kHz, 2kHz, 4kHz, 8kHz 평균
- low: 0.125, 0.25, 0.5kHz 평균
- mid: 1kHz, 2kHz 평균
- high: 3kHz, 4kHz, 8kHz 평균
- severity용: 500Hz, 1kHz, 2kHz, 3kHz 평균

### Severity 등급 (청력 손실 정도)
- 0: normal (20 dB 미만)
- 1: mild (20~39 dB)
- 2: moderate (40~59 dB)
- 3: severe (60~79 dB)
- 4: profound (80~100 dB)
- 5: deaf (100 dB 이상)

### Audiogram Type (청력도 형태)
- 1: ascending (저주파 난청)
- 2: U shape
- 3: descending (고주파 난청)
- 4: flat (15dB 차이 이내)
- 5: deaf (>=100dB)
- 6: 기타

### 고막 상태 (ICW 시트에만 있음)
- 0: no perforation (천공 없음)
- 1: 25% 미만
- 2: 25%~50% or two quadrants
- 3: 50%~75% or three quadrants
- 4: 70% 이상
- 고막상태_Rt, 고막상태_Lt: 수술 전/후 고막 상태

### 어음 청력 검사
- SRT: Speech Reception Threshold (dB)
- SDS: Speech Discrimination Score (%)

### 고막 사진/검사 이미지
- 고막사진: Before, 수술 후_3M, 수술 후_6M, 수술 후_1Y 시점별 사진 ID
- 검사결과 이미지: PTA, Speech, PTA+Speech 이미지 ID (예: C234P1, C234S1)

### 수술 관련
- 수술영상 유/무
- Tympanoplasty 종류 (Rt/Lt - 우측/좌측)
- 특이사항 메모

### ICW 시트 전용 추가 컬럼
- Duration_ES-Surgery date: 내시경 검사와 수술 간격

---

## 7. 시뮬레이션에 활용할 핵심 데이터

### 입력 변수
- 고막 천공 크기 (0~4 단계)
- 고막 천공 위치 (4분면)
- 주파수 (0.125kHz ~ 8kHz)

### 검증용 Ground Truth
- 주파수별 청력 역치 변화 (수술전 vs 수술후)
- Air-Bone Gap (기도-골도 차이) = 전음성 난청 정도 = 고막/이소골 문제로 인한 청력 손실

### 핵심 비교
시뮬레이션 예측 감쇄량 vs 실제 환자의 Air-Bone Gap

---

## 8. 논문용 정당화 문구 (참고)

"We employed a simplified wave propagation model based on geometric acoustics principles, where vibration intensity follows inverse-square law attenuation through apertures and exponential decay through solid media. While this approach does not capture full wave phenomena such as diffraction, it provides computationally efficient real-time visualization suitable for interactive simulation environments."

---

## 9. 요청사항
1. 고막 mesh 정보 확인 스크립트 제공 (vertex 수, triangle 수, submesh 수)
2. mesh 정보 확인 후, 구멍 생성 방식 결정 및 전체 시스템 구조 설계
3. Unity C# 스크립트로 구현
4. 시뮬레이션 결과와 실제 데이터 비교 검증 방법 제안